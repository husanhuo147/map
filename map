<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>圣安德烈斯市 互动狩猎地图</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin:0; padding:0; background:#000; overflow:hidden; }
        #map { height: 100vh; width: 100vw; }
        .blue-label div { background:#007bff !important; color:white; padding:10px 22px; border-radius:30px; font-size:17px; font-weight:bold; box-shadow:0 4px 20px rgba(0,123,255,0.8); white-space:nowrap; }
        .red-area { color:red; weight:6; opacity:0.8; fillOpacity:0; }
        .my-position div { background:red; width:30px; height:30px; border-radius:50%; border:5px solid white; animation:pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow:0 0 0 0 rgba(255,0,0,0.7); } 70% { box-shadow:0 0 0 25px rgba(255,0,0,0); } 100% { box-shadow:0 0 0 0 rgba(255,0,0,0); } }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-arrowheads@1.3.0/dist/leaflet-arrowheads.min.js"></script>
    <script>
        // 圣安德烈斯市中心坐标（虚构布局）
        const map = L.map('map').setView([34.0522, -118.2437], 11);

        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/dark-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            attribution: 'Mapbox'
        }).addTo(map);

        // 当前位置标记
        const myPosition = L.marker([34.0736, -118.4004], { // 默认起始：贝弗利山庄
            icon: L.divIcon({
                className: 'my-position',
                html: '<div></div><div style="color:white; margin-top:10px; font-size:20px; text-shadow:0 0 10px red;"><b>你在这儿</b></div>',
                iconSize: [50, 70],
                iconAnchor: [25, 70]
            })
        }).addTo(map).bindPopup("当前位置").openPopup();

        // 所有区域坐标与名称（可根据想象微调）
        const locations = {
            // 贝弗利山庄区域
            "beverly":          [34.0736, -118.4004, "贝弗利山庄"], 
            "cloud_mansion":    [34.0800, -118.4100, "云顶豪宅区"],
            "rodeo_drive":      [34.0690, -118.4020, "罗迪欧购物街"],
            "velvet_club":      [34.0750, -118.3950, "天鹅绒俱乐部"],

            // 枫叶大道区域
            "maple_ave":        [34.1000, -118.3000, "枫叶大道"],
            "tree_community":   [34.1050, -118.2900, "树社区"],
            "community_mall":   [34.0950, -118.3100, "社区购物中心"],
            "municipal_park":   [34.1100, -118.3050, "市政公园"],

            // 圣玛丽学区
            "st_mary":          [34.0200, -118.2800, "圣玛丽学区"],
            "st_mary_school":   [34.0180, -118.2750, "圣玛丽女子高中"],
            "uni_apartments":   [34.0250, -118.2850, "大学城公寓"],
            "library":          [34.0220, -118.2780, "学术图书馆"],

            // 霓虹街区域
            "neon_street":      [33.9800, -118.2400, "霓虹街"],
            "red_light":        [33.9750, -118.2350, "红灯区主街"],
            "abandoned_ind":    [33.9700, -118.2500, "废弃工业区"],
            "underground_market":[33.9850, -118.2450, "地下黑市"]
        };

        // 添加蓝色气泡标签
        function addBlueLabel(key) {
            const [lat, lng, text] = locations[key];
            L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'blue-label',
                    html: `<div>${text} →</div>`,
                    iconSize: [null, null]
                })
            }).addTo(map);
        }

        // 初始显示所有主要区域标签
        Object.keys(locations).forEach(addBlueLabel);

        // 用红色粗线圈出四大主区域
        L.circle(locations["beverly"][0], locations["beverly"][1], {radius: 6000, className: 'red-area'}).addTo(map);
        L.circle(locations["maple_ave"][0], locations["maple_ave"][1], {radius: 5000, className: 'red-area'}).addTo(map);
        L.circle(locations["st_mary"][0], locations["st_mary"][1], {radius: 4000, className: 'red-area'}).addTo(map);
        L.circle(locations["neon_street"][0], locations["neon_street"][1], {radius: 5500, className: 'red-area'}).addTo(map);

        // 读取 URL 参数自动移动
        const urlParams = new URLSearchParams(window.location.search);
        const locKey = urlParams.get('loc');
        if (locKey && locations[locKey]) {
            const [lat, lng, name] = locations[locKey];
            myPosition.setLatLng([lat, lng]);
            map.flyTo([lat, lng], 13, { duration: 2.5 });
            myPosition.bindPopup(`已到达：${name}`).openPopup();
        }
    </script>
</body>
</html>
