<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>圣安德烈斯市 互动狩猎地图</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin:0; padding:0; background:#000; overflow:hidden; }
        #map { height: 100vh; width: 100vw; }

        .blue-label div {
            background: #3388ff;
            color: white;
            padding: 12px 28px;
            border-radius: 50px;
            font-size: 19px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 4px 20px rgba(51,136,255,0.7);
        }
        .blue-label div::after {
            content: " →";
            font-size: 24px;
        }

        .my-position div {
            background: red;
            width: 34px;
            height: 34px;
            border-radius: 50%;
            border: 6px solid white;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255,0,0,0.7); }
            70% { box-shadow: 0 0 0 30px rgba(255,0,0,0); }
            100% { box-shadow: 0 0 0 0 rgba(255,0,0,0); }
        }

        .hand-circle { color: red; weight: 8; opacity: 0.9; fillOpacity: 0; dashArray: "12,10"; lineCap: "round"; }
        .hand-arrow { color: red; weight: 9; opacity: 0.9; lineCap: "round"; }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-arrowheads@1.3.0/dist/leaflet-arrowheads.min.js"></script>
    <script>
        const map = L.map('map').setView([34.0522, -118.2437], 11);

        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/dark-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            attribution: 'Mapbox'
        }).addTo(map);

        const myPosition = L.marker([34.0736, -118.4004], {
            icon: L.divIcon({
                className: 'my-position',
                html: '<div></div><div style="color:white; margin-top:12px; font-size:22px; text-shadow:0 0 12px red;"><b>你在这儿</b></div>',
                iconSize: [60, 80],
                iconAnchor: [30, 80]
            })
        }).addTo(map).bindPopup("当前位置").openPopup();

        const locations = {
            "beverly": [34.0736, -118.4004, "贝弗利山庄"],
            "cloud_mansion": [34.0800, -118.4100, "云顶豪宅区"],
            "rodeo_drive": [34.0690, -118.4020, "罗迪欧购物街"],
            "velvet_club": [34.0750, -118.3950, "天鹅绒俱乐部"],
            "maple_ave": [34.1000, -118.3000, "枫叶大道"],
            "tree_community": [34.1050, -118.2900, "树社区"],
            "community_mall": [34.0950, -118.3100, "社区购物中心"],
            "municipal_park": [34.1100, -118.3050, "市政公园"],
            "st_mary": [34.0200, -118.2800, "圣玛丽学区"],
            "st_mary_school": [34.0180, -118.2750, "圣玛丽女子高中"],
            "uni_apartments": [34.0250, -118.2850, "大学城公寓"],
            "library": [34.0220, -118.2780, "学术图书馆"],
            "neon_street": [33.9800, -118.2400, "霓虹街"],
            "red_light": [33.9750, -118.2350, "红灯区主街"],
            "abandoned_ind": [33.9700, -118.2500, "废弃工业区"],
            "underground_market": [33.9850, -118.2450, "地下黑市"]
        };

        function addBlueLabel(key) {
            const [lat, lng, text] = locations[key];
            L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'blue-label',
                    html: `<div>${text}</div>`,
                    iconSize: [null, null]
                })
            }).addTo(map);
        }
        Object.keys(locations).forEach(addBlueLabel);

        L.circle([34.0736, -118.4004], {radius: 6500, className: 'hand-circle'}).addTo(map);
        L.circle([34.1000, -118.3000], {radius: 5500, className: 'hand-circle'}).addTo(map);
        L.circle([34.0200, -118.2800], {radius: 4500, className: 'hand-circle'}).addTo(map);
        L.circle([33.9800, -118.2400], {radius: 6000, className: 'hand-circle'}).addTo(map);

        L.polyline([[34.15, -118.50], [34.0736, -118.4004]], {className: 'hand-arrow'}).arrowheads({size: '35px', frequency: 'endonly'}).addTo(map);
        L.polyline([[34.15, -118.20], [34.1000, -118.3000]], {className: 'hand-arrow'}).arrowheads({size: '35px', frequency: 'endonly'}).addTo(map);
        L.polyline([[34.00, -118.20], [33.9800, -118.2400]], {className: 'hand-arrow'}).arrowheads({size: '35px', frequency: 'endonly'}).addTo(map);
        L.polyline([[34.05, -118.35], [34.0690, -118.4020]], {className: 'hand-arrow'}).arrowheads({size: '35px', frequency: 'endonly'}).addTo(map);

        const urlParams = new URLSearchParams(window.location.search);
        const locKey = urlParams.get('loc');
        if (locKey && locations[locKey]) {
            const [lat, lng, name] = locations[locKey];
            myPosition.setLatLng([lat, lng]);
            map.flyTo([lat, lng], 13, { duration: 3 });
            myPosition.bindPopup(`已到达：${name}`).openPopup();
        }
    </script>
</body>
</html>
